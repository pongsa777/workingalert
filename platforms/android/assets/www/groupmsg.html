<html>

<head>
    <link href="css/groupmsg.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/roboto.min.css" rel="stylesheet">
    <link href="css/material.min.css" rel="stylesheet">
    <link href="css/ripples.min.css" rel="stylesheet">
</head>

<body>

    <header class="shadow-z-1">
        <div id="title">
            <bold>{Group Name}</bold>
        </div>
        <a href="groupsetting.html">
            <div id="group-setting">
                <img src="pic/group_setting.png" class="right-menu-icon" width="32px" style="margin-top:10px">
            </div>
        </a>
    </header>
    <div style="margin-top:54px;z-index:1"></div>
    <div class="sidebar-overlay"></div>

    <!--<div class="container">-->
    <div class="listmsg" id="listmsg">
        <!--
        <div class="msg">
            <div class="detail">
                <h1>{Group msg}</h1>
                <input type="hidden" value="" id="msgid">
                <input type="hidden" value="" id="fromid">
                <h4>{priority}</h4>
            </div>
            <div class="widget">
                <p><img src="pic/dot_menu.png"></p>
            </div>
            <div style="clear:both;"></div>
            <div class="seperate"></div>
        </div>
        -->
        <a href="createmsg.html">
            <div id="createmsg" class="shadow-z-3">
                <img src="pic/broadcast.png" width="30px">
            </div>
        </a>


    </div>
    <!--</div listgroup>-->



    <!-- end of html -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="cordova_plugins.js"></script>
    <script>
        $(document).ready(function() {

            document.addEventListener("deviceready", onDeviceReady, false);

            function onDeviceReady() {
                document.addEventListener("backbutton", function(e) {
                    document.location.href = "mainmenu.html";
                }, false);
            }

            // This command is used to initialize some elements and make them work properly
            //$.material.init();
            var groupid = localStorage.getItem("parentgroupid");
            var sessionid = localStorage.getItem("sessionid");

            alert(groupid + ' ' + sessionid);
            var url = "http://workingalert.tk/api/getmessage.php?sessionid=" + sessionid + "&groupid=" + groupid;
            $.get(url, function(data, status) {
                if (data.status == 'success') {
                    //insert group name to toolbar
                    document.getElementById('title').innerHTML = "<bold>" + data.groupname + "</bold>";

                    //insert message 
                    for (var i = 0; i < data.message.length; i++) {
                        var msgid = data.message[i].id;
                        var bodymsg = data.message[i].body;
                        var priority = data.message[i].priority;
                        var from = data.message[i].fromid;
                        var div = document.createElement('div');
                        div.className = 'msg';
                        div.innerHTML = '<div class="msg"><div class="detail ' + i + '"><h1>' + bodymsg + '</h1><input type="hidden" value="' + msgid + '" id="msgid' + i + '"><input type="hidden" value="' + from + '" id="fromid"><h4>' + priority + '</h4></div><div class="widget"><p><img src="pic/dot_menu.png"></p></div><div style="clear:both;"></div><div class="seperate"></div></div>';
                        document.getElementById('listmsg').appendChild(div);
                    }
                }
            });

            $(document).on("click", ".detail", function() {
                var pos = $(this).attr("class").replace("detail ", "");
                var msgid = $(".detail." + pos + " #msgid" + pos).val();
                alert(msgid);
                var confirmurl = "http://workingalert.tk/api/confirmread.php?sessionid="+sessionid+"&messageid="+msgid;
                alert(confirmurl);
                $.get(confirmurl, function(data, status) {
                    if (data.status == 'success') {
                        alert(JSON.stringify(data));
                    }else{
                        alert(JSON.stringify(data));
                    }
                });
            });

        });

    </script>
</body>

</html>
